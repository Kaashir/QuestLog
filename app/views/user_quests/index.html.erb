<div class="container" style="min-height: 100vh; background-image: url(<%= asset_path("forest_background.png") %>); background-size: cover; background-position: center; background-repeat: no-repeat; background-attachment: fixed;">
  <div class="quest-path">
    <%
      # Get quests ordered with completed ones at the bottom

      # Create a hash mapping positions to quests
      quest_positions = {}
      position = 1
      @current_user_quests.each do |quest|
        quest_positions[position] = quest
        position += 1
      end

      # Function to determine column position (1-4) based on quest position
      def get_column(position)
        # Create a repeating pattern that goes: 4->3->2->1->2->3->4->3->2->1
        # This creates a zigzag pattern from right to left and back
        base_sequence = [4,3,2,1,2,3,4,3,2,1]
        position_in_sequence = (position - 1) % base_sequence.length
        base_sequence[position_in_sequence]
      end

      # Iterate through quests in order
      quest_positions.each do |position, quest|
        column = get_column(position)
    %>
      <div class="quest-row">
        <div class="quest-node" style="margin-left: <%= (column - 1) * 25 %>%;">
          <div class="quest-card <%= quest.completed_frequency == quest.quest.frequency ? 'completed' : '' %>
            <%=
              completion_percentage = (quest.completed_frequency.to_f / quest.quest.frequency.to_f) * 100
              case completion_percentage
              when 0..15
                'progress-blue'
              when 16..34
                'progress-25'
              when 35..64
                'progress-50'
              when 65..99
                'progress-75'
              when 100
                'progress-gold'
              end
            %>"
            data-bs-toggle="modal" data-bs-target="#modal-<%= quest.id %>">
            <div class="quest-icon">
              <%= image_tag quest.quest.quest_category.icon, alt: "Quest Icon", class: "quest-icon-img" %>
            </div>
            <div class="quest-progress">
              <p><%= quest.completed_frequency %>/<%= quest.quest.frequency %></p>
            </div>
            <div class="quest-title">
              <h3><%= quest.quest.title %></h3>
            </div>
          </div>
          <%= render "show_modal", user_quest: quest %>
        </div>
      </div>
    <% end %>
  </div>

  <div style="position: fixed; bottom: 24px; left: 24px; z-index: 10; display: flex; align-items: flex-end;">
    <% hero_class_name = @current_user_class.first.hero_class.name.downcase %>
    <% image_name =
      case hero_class_name
      when "warrior"
        "warrior-no-background.png"
      when "monk"
        "monk-no-background.png"
      when "healer"
        "healer-no-background.png"
      end
    %>
    <% if image_name %>
      <div style="position: relative; display: inline-block;">
        <%= image_tag image_name, style: "max-width: 100px; display: block;" %>
        <div style="position: absolute; top: 50%; right: 0; transform: translateY(-50%) translateX(50%); border: 6px solid rgba(166, 199, 230, 0.2); border-radius: 999px; padding: 2px; background: transparent;">
          <%= link_to "+", new_user_quest_path, class: "add-quest-button", style: "background-color: #2A3B6E; color: #fff; border-radius: 999px; width: 30px; height: 30px; border: none; font-size: 1.2rem; display: flex; align-items: center; justify-content: center; text-decoration: none; font-family: 'GNF', sans-serif;" %>
        </div>
      </div>
    <% end %>
  </div>
</div>
